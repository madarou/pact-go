# The container definition we want to use for developing our app
box: 
  id: mefellows/pact-go-docker-build
  entrypoint: /bin/bash

build:
  steps:
    - setup-go-workspace
    # - script:
    #     name: install packages
    #     code: |
    #       apt-get update
    #       apt-get install -y software-properties-common unzip zip wget curl
    #       gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
    #       curl -sSL https://get.rvm.io | sudo bash -s stable
    #       /bin/bash -l -c "rvm requirements"
    #       /bin/bash -l -c "rvm install 2.2.2"
    #       /bin/bash -l -c "gem install bundler --no-ri --no-rdoc"
    - golint:
        exclude: "vendor"
    - script:
        name: build
        code: |
          make bin
    - script:
        name: test
        code: |
          make test
    - script:
        name: Publish Coveralls
        code: goveralls -service="wercker.com" -coverprofile=profile.cov -repotoken $COVERALLS_TOKEN
    - script:
        name: package
        code: |
          . /etc/profile.d/rvm.sh
          make package
    - script:
        name: pact
        code: |
          ./scripts/pact.sh

# TODO: Get tokens for Pact foundation
deploy:
    steps:
        - tcnksm/ghr:
            token: $GITHUB_TOKEN
            version: $RELEASE_VERSION
            input: dist
            replace: $RELEASE_IS_DRAFT
            pre-release: $RELEASE_IS_DRAFT
